schema: '2.0'
stages:
  ingest:
    cmd: Rscript pipeline/00-ingest.R
    deps:
    - path: pipeline/00-ingest.R
      hash: md5
      md5: ba511f437084330eb1b2872fc8d1a6bb
      size: 23068
    params:
      params.yaml:
        assessment:
          year: '2024'
          date: '2024-01-01'
          triad: north
          group: residential
          data_year: '2023'
          working_year: '2025'
        input:
          min_sale_year: '2015'
          max_sale_year: '2023'
          n_years_prior: 4
          complex:
            match_exact:
            - meta_township_code
            - meta_class
            - char_bsmt
            - char_gar1_size
            - char_attic_fnsh
            - char_beds
            - meta_pin_num_cards
            - meta_tieback_proration_rate
            match_fuzzy:
              rooms: 1
              bldg_sf: 25
              yrblt: 4
              dist_ft: 250
    outs:
    - path: input/assessment_data.parquet
      hash: md5
      md5: 164e4a8112c59a1acaab48165698bd0b
      size: 425171691
    - path: input/char_data.parquet
      hash: md5
      md5: b8f8c4c34a7555ebfa8b0088543dcc43
      size: 847176493
    - path: input/complex_id_data.parquet
      hash: md5
      md5: d4fd1df964a7c652615c915cb5e720e3
      size: 703353
    - path: input/hie_data.parquet
      hash: md5
      md5: b41c06ffcc0cfc46fa7fcb818e8de472
      size: 1933983
    - path: input/land_nbhd_rate_data.parquet
      hash: md5
      md5: f3ec9627322bd271bf2957b7388aaa34
      size: 3873
    - path: input/training_data.parquet
      hash: md5
      md5: 7cabbe48e9ee4e6dc374dafe1bac37c4
      size: 208429617
  train:
    cmd: Rscript pipeline/01-train.R
    deps:
    - path: input/training_data.parquet
      hash: md5
      md5: d662d199383f18567643185cbc0f64db
      size: 209497727
    - path: pipeline/01-train.R
      hash: md5
      md5: 46115d48cf066d35b0db14dc13a8d9b3
      size: 17448
    params:
      params.yaml:
        cv:
          split_prop: 0.9
          num_folds: 10
          fold_overlap: 9
          initial_set: 20
          max_iterations: 50
          no_improve: 15
          uncertain: 8
          best_metric: rmse
        model.engine: lightgbm
        model.hyperparameter:
          default:
            num_iterations: 1575
            learning_rate: 0.015
            max_bin: 512
            num_leaves: 185
            add_to_linked_depth: 4
            feature_fraction: 0.61
            min_gain_to_split: 75.5
            min_data_in_leaf: 31
            max_cat_threshold: 165
            min_data_per_group: 300
            cat_smooth: 82.0
            cat_l2: 1.0
            lambda_l1: 0.022
            lambda_l2: 0.152
          range:
            num_iterations:
            - 100
            - 2500
            learning_rate:
            - -3.0
            - -0.4
            max_bin:
            - 50
            - 512
            num_leaves:
            - 32
            - 2048
            add_to_linked_depth:
            - 1
            - 7
            feature_fraction:
            - 0.3
            - 0.7
            min_gain_to_split:
            - -3.0
            - 4.0
            min_data_in_leaf:
            - 2
            - 400
            max_cat_threshold:
            - 10
            - 250
            min_data_per_group:
            - 2
            - 400
            cat_smooth:
            - 10.0
            - 200.0
            cat_l2:
            - -3
            - 2
            lambda_l1:
            - -3
            - 2
            lambda_l2:
            - -3
            - 2
        model.objective: rmse
        model.parameter:
          validation_prop: 0.1
          validation_type: random
          validation_metric: rmse
          link_max_depth: true
          stop_iter: 50
        model.predictor:
          all:
          - meta_township_code
          - meta_nbhd_code
          - meta_sale_count_past_n_years
          - char_yrblt
          - char_air
          - char_apts
          - char_attic_fnsh
          - char_attic_type
          - char_beds
          - char_bldg_sf
          - char_bsmt
          - char_bsmt_fin
          - char_class
          - char_ext_wall
          - char_fbath
          - char_frpl
          - char_gar1_att
          - char_gar1_cnst
          - char_gar1_size
          - char_hbath
          - char_land_sf
          - char_heat
          - char_ncu
          - char_porch
          - char_roof_cnst
          - char_rooms
          - char_tp_dsgn
          - char_type_resd
          - char_recent_renovation
          - loc_longitude
          - loc_latitude
          - loc_census_tract_geoid
          - loc_env_flood_fs_factor
          - loc_env_airport_noise_dnl
          - loc_school_elementary_district_geoid
          - loc_school_secondary_district_geoid
          - loc_access_cmap_walk_nta_score
          - loc_access_cmap_walk_total_score
          - loc_tax_municipality_name
          - prox_num_pin_in_half_mile
          - prox_num_bus_stop_in_half_mile
          - prox_num_foreclosure_per_1000_pin_past_5_years
          - prox_num_school_in_half_mile
          - prox_num_school_with_rating_in_half_mile
          - prox_avg_school_rating_in_half_mile
          - prox_airport_dnl_total
          - prox_nearest_bike_trail_dist_ft
          - prox_nearest_cemetery_dist_ft
          - prox_nearest_cta_route_dist_ft
          - prox_nearest_cta_stop_dist_ft
          - prox_nearest_hospital_dist_ft
          - prox_lake_michigan_dist_ft
          - prox_nearest_major_road_dist_ft
          - prox_nearest_metra_route_dist_ft
          - prox_nearest_metra_stop_dist_ft
          - prox_nearest_park_dist_ft
          - prox_nearest_railroad_dist_ft
          - prox_nearest_secondary_road_dist_ft
          - prox_nearest_university_dist_ft
          - prox_nearest_vacant_land_dist_ft
          - prox_nearest_water_dist_ft
          - prox_nearest_golf_course_dist_ft
          - acs5_percent_age_children
          - acs5_percent_age_senior
          - acs5_median_age_total
          - acs5_percent_mobility_no_move
          - acs5_percent_mobility_moved_from_other_state
          - acs5_percent_household_family_married
          - acs5_percent_household_nonfamily_alone
          - acs5_percent_education_high_school
          - acs5_percent_education_bachelor
          - acs5_percent_education_graduate
          - acs5_percent_income_below_poverty_level
          - acs5_median_income_household_past_year
          - acs5_median_income_per_capita_past_year
          - acs5_percent_income_household_received_snap_past_year
          - acs5_percent_employment_unemployed
          - acs5_median_household_total_occupied_year_built
          - acs5_median_household_renter_occupied_gross_rent
          - acs5_percent_household_owner_occupied
          - acs5_percent_household_total_occupied_w_sel_cond
          - acs5_percent_mobility_moved_in_county
          - other_tax_bill_rate
          - other_school_district_elementary_avg_rating
          - other_school_district_secondary_avg_rating
          - ccao_is_active_exe_homeowner
          - ccao_is_corner_lot
          - ccao_n_years_exe_homeowner
          - time_sale_year
          - time_sale_day
          - time_sale_quarter_of_year
          - time_sale_month_of_year
          - time_sale_day_of_year
          - time_sale_day_of_month
          - time_sale_day_of_week
          - time_sale_post_covid
          categorical:
          - meta_township_code
          - meta_nbhd_code
          - char_air
          - char_apts
          - char_attic_fnsh
          - char_attic_type
          - char_bsmt
          - char_bsmt_fin
          - char_class
          - char_ext_wall
          - char_gar1_att
          - char_gar1_cnst
          - char_gar1_size
          - char_heat
          - char_porch
          - char_roof_cnst
          - char_tp_dsgn
          - char_type_resd
          - loc_census_tract_geoid
          - loc_tax_municipality_name
          - loc_school_elementary_district_geoid
          - loc_school_secondary_district_geoid
          - time_sale_quarter_of_year
          id:
          - meta_year
          - meta_pin
          - meta_class
          - meta_card_num
          - meta_sale_document_num
        model.seed: 2024
        model.verbose: -1
        ratio_study:
          far_year: '2021'
          far_stage: board
          far_column: meta_2yr_pri_board_tot
          near_year: '2023'
          near_stage: certified
          near_column: meta_certified_tot
          min_n_sales: 30
          num_quantile:
          - 3
          - 5
          - 10
          geographies:
          - meta_township_code
          - meta_nbhd_code
          - loc_tax_municipality_name
          - loc_ward_num
          - loc_census_puma_geoid
          - loc_census_tract_geoid
          - loc_school_elementary_district_geoid
          - loc_school_secondary_district_geoid
          - loc_school_unified_district_geoid
        toggle.cv_enable: false
    outs:
    - path: output/intermediate/timing/model_timing_train.parquet
      hash: md5
      md5: 698cbbe8c54c72f556b930dd0ed27f91
      size: 2879
    - path: output/parameter_final/model_parameter_final.parquet
      hash: md5
      md5: dc8b9dc7e803c36addd98a3e68a032f0
      size: 8516
    - path: output/parameter_range/model_parameter_range.parquet
      hash: md5
      md5: 150000269b5873fa1b3eaeeff7887ce2
      size: 501
    - path: output/parameter_search/model_parameter_search.parquet
      hash: md5
      md5: 150000269b5873fa1b3eaeeff7887ce2
      size: 501
    - path: output/test_card/model_test_card.parquet
      hash: md5
      md5: eed31871d7fe6faca8d2b8467a4f4002
      size: 2236787
    - path: output/workflow/fit/model_workflow_fit.zip
      hash: md5
      md5: 2978630c5139ddbf21a7a6693dc492ff
      size: 11775704
    - path: output/workflow/recipe/model_workflow_recipe.rds
      hash: md5
      md5: 7fa3c3b5b84bb3c75b77dec441d0f5e8
      size: 1955567
  assess:
    cmd: Rscript pipeline/02-assess.R
    deps:
    - path: input/assessment_data.parquet
      hash: md5
      md5: af14e5cc79bd08d679ffaa969df292c7
      size: 427188490
    - path: input/complex_id_data.parquet
      hash: md5
      md5: c453537444b319bdd023117a4e2ec3a4
      size: 703686
    - path: input/land_nbhd_rate_data.parquet
      hash: md5
      md5: 6c1baaf2acbcba9869025bb336f4ad25
      size: 4413
    - path: input/training_data.parquet
      hash: md5
      md5: d662d199383f18567643185cbc0f64db
      size: 209497727
    - path: output/workflow/fit/model_workflow_fit.zip
      hash: md5
      md5: 2978630c5139ddbf21a7a6693dc492ff
      size: 11775704
    - path: output/workflow/recipe/model_workflow_recipe.rds
      hash: md5
      md5: 7fa3c3b5b84bb3c75b77dec441d0f5e8
      size: 1955567
    - path: pipeline/02-assess.R
      hash: md5
      md5: 9e5e0ee8a6d1ceccbc689b2335b6a707
      size: 22026
    params:
      params.yaml:
        assessment:
          year: '2024'
          date: '2024-01-01'
          triad: city
          group: residential
          data_year: '2023'
          working_year: '2024'
        model.predictor.all:
        - meta_township_code
        - meta_nbhd_code
        - meta_sale_count_past_n_years
        - char_yrblt
        - char_air
        - char_apts
        - char_attic_fnsh
        - char_attic_type
        - char_beds
        - char_bldg_sf
        - char_bsmt
        - char_bsmt_fin
        - char_class
        - char_ext_wall
        - char_fbath
        - char_frpl
        - char_gar1_att
        - char_gar1_cnst
        - char_gar1_size
        - char_hbath
        - char_land_sf
        - char_heat
        - char_ncu
        - char_porch
        - char_roof_cnst
        - char_rooms
        - char_tp_dsgn
        - char_type_resd
        - char_recent_renovation
        - loc_longitude
        - loc_latitude
        - loc_census_tract_geoid
        - loc_env_flood_fs_factor
        - loc_env_airport_noise_dnl
        - loc_school_elementary_district_geoid
        - loc_school_secondary_district_geoid
        - loc_access_cmap_walk_nta_score
        - loc_access_cmap_walk_total_score
        - loc_tax_municipality_name
        - prox_num_pin_in_half_mile
        - prox_num_bus_stop_in_half_mile
        - prox_num_foreclosure_per_1000_pin_past_5_years
        - prox_num_school_in_half_mile
        - prox_num_school_with_rating_in_half_mile
        - prox_avg_school_rating_in_half_mile
        - prox_airport_dnl_total
        - prox_nearest_bike_trail_dist_ft
        - prox_nearest_cemetery_dist_ft
        - prox_nearest_cta_route_dist_ft
        - prox_nearest_cta_stop_dist_ft
        - prox_nearest_hospital_dist_ft
        - prox_lake_michigan_dist_ft
        - prox_nearest_major_road_dist_ft
        - prox_nearest_metra_route_dist_ft
        - prox_nearest_metra_stop_dist_ft
        - prox_nearest_park_dist_ft
        - prox_nearest_railroad_dist_ft
        - prox_nearest_secondary_road_dist_ft
        - prox_nearest_university_dist_ft
        - prox_nearest_vacant_land_dist_ft
        - prox_nearest_water_dist_ft
        - prox_nearest_golf_course_dist_ft
        - acs5_percent_age_children
        - acs5_percent_age_senior
        - acs5_median_age_total
        - acs5_percent_mobility_no_move
        - acs5_percent_mobility_moved_from_other_state
        - acs5_percent_household_family_married
        - acs5_percent_household_nonfamily_alone
        - acs5_percent_education_high_school
        - acs5_percent_education_bachelor
        - acs5_percent_education_graduate
        - acs5_percent_income_below_poverty_level
        - acs5_median_income_household_past_year
        - acs5_median_income_per_capita_past_year
        - acs5_percent_income_household_received_snap_past_year
        - acs5_percent_employment_unemployed
        - acs5_median_household_total_occupied_year_built
        - acs5_median_household_renter_occupied_gross_rent
        - acs5_percent_household_owner_occupied
        - acs5_percent_household_total_occupied_w_sel_cond
        - acs5_percent_mobility_moved_in_county
        - other_tax_bill_rate
        - other_school_district_elementary_avg_rating
        - other_school_district_secondary_avg_rating
        - ccao_is_active_exe_homeowner
        - ccao_is_corner_lot
        - ccao_n_years_exe_homeowner
        - time_sale_year
        - time_sale_day
        - time_sale_quarter_of_year
        - time_sale_month_of_year
        - time_sale_day_of_year
        - time_sale_day_of_month
        - time_sale_day_of_week
        - time_sale_post_covid
        pv:
          multicard_yoy_cap: 2.2
          land_pct_of_total_cap: 0.5
          round_break:
          - 1000
          - 10000
          - 100000
          round_to_nearest:
          - 1
          - 500
          - 5000
          - 10000
          round_type: floor
        ratio_study:
          far_year: '2021'
          far_stage: board
          far_column: meta_2yr_pri_board_tot
          near_year: '2023'
          near_stage: certified
          near_column: meta_certified_tot
          min_n_sales: 30
          num_quantile:
          - 3
          - 5
          - 10
          geographies:
          - meta_township_code
          - meta_nbhd_code
          - loc_tax_municipality_name
          - loc_ward_num
          - loc_census_puma_geoid
          - loc_census_tract_geoid
          - loc_school_elementary_district_geoid
          - loc_school_secondary_district_geoid
          - loc_school_unified_district_geoid
    outs:
    - path: output/assessment_card/model_assessment_card.parquet
      hash: md5
      md5: 57dd10212751ae60c2f9606879d94aaa
      size: 207540040
    - path: output/assessment_pin/model_assessment_pin.parquet
      hash: md5
      md5: 2cec8814319002707e70d69722879243
      size: 91166836
    - path: output/intermediate/timing/model_timing_assess.parquet
      hash: md5
      md5: 6ef4d22386fca6ebc8ac1998a6fbd618
      size: 2879
  evaluate:
    cmd: Rscript pipeline/03-evaluate.R
    deps:
    - path: output/assessment_pin/model_assessment_pin.parquet
      hash: md5
      md5: 2cec8814319002707e70d69722879243
      size: 91166836
    - path: output/test_card/model_test_card.parquet
      hash: md5
      md5: eed31871d7fe6faca8d2b8467a4f4002
      size: 2236787
    - path: pipeline/03-evaluate.R
      hash: md5
      md5: 988f0e78db1d0299d747ed149929877d
      size: 16910
    params:
      params.yaml:
        assessment:
          year: '2024'
          date: '2024-01-01'
          triad: city
          group: residential
          data_year: '2023'
          working_year: '2024'
        ratio_study:
          far_year: '2021'
          far_stage: board
          far_column: meta_2yr_pri_board_tot
          near_year: '2023'
          near_stage: certified
          near_column: meta_certified_tot
          min_n_sales: 30
          num_quantile:
          - 3
          - 5
          - 10
          geographies:
          - meta_township_code
          - meta_nbhd_code
          - loc_tax_municipality_name
          - loc_ward_num
          - loc_census_puma_geoid
          - loc_census_tract_geoid
          - loc_school_elementary_district_geoid
          - loc_school_secondary_district_geoid
          - loc_school_unified_district_geoid
    outs:
    - path: output/intermediate/timing/model_timing_evaluate.parquet
      hash: md5
      md5: 5ee1fc0badede6f048e600047bd68e15
      size: 2907
    - path: output/performance/model_performance_assessment.parquet
      hash: md5
      md5: 6d96d17124aa7550a0fff43f7ab2ba4e
      size: 5074212
    - path: output/performance/model_performance_test.parquet
      hash: md5
      md5: f140953863dbf6b0b14f0ce304b9b773
      size: 8323788
    - path: output/performance_quantile/model_performance_quantile_assessment.parquet
      hash: md5
      md5: 3407640ad9611e465ef3cf606b9eb594
      size: 1628099
    - path: output/performance_quantile/model_performance_quantile_test.parquet
      hash: md5
      md5: 22e7bf8bd15d6adb27ecea89ace74ba9
      size: 4831431
  interpret:
    cmd: Rscript pipeline/04-interpret.R
    deps:
    - path: pipeline/04-interpret.R
      hash: md5
      md5: 1cc57c0bcdaf2725fa343c6d88c1592c
      size: 9619
    - path: input/assessment_data.parquet
      hash: md5
      md5: 582a6197429e99ee24271a3d4f9e9323
      size: 83202423
    - path: output/workflow/fit/model_workflow_fit.zip
      hash: md5
      md5: 2b5b209f96c29217a62907a656793c84
      size: 1591741
    - path: output/workflow/recipe/model_workflow_recipe.rds
      hash: md5
      md5: 6365fd821ed4322bd2181e6996cbbe6e
      size: 1863122
    params:
      params.yaml:
        model.predictor.all:
        - meta_township_code
        - meta_nbhd_code
        - meta_modeling_group
        - meta_tieback_proration_rate
        - char_yrblt
        - char_air
        - char_apts
        - char_attic_fnsh
        - char_attic_type
        - char_beds
        - char_bldg_sf
        - char_bsmt
        - char_bsmt_fin
        - char_ext_wall
        - char_fbath
        - char_frpl
        - char_gar1_area
        - char_gar1_att
        - char_gar1_cnst
        - char_gar1_size
        - char_hbath
        - char_land_sf
        - char_heat
        - char_ncu
        - char_porch
        - char_roof_cnst
        - char_rooms
        - char_tp_dsgn
        - char_tp_plan
        - char_type_resd
        - char_recent_renovation
        - loc_longitude
        - loc_latitude
        - loc_env_flood_fema_sfha
        - loc_env_flood_fs_factor
        - loc_env_flood_fs_risk_direction
        - loc_env_airport_noise_dnl
        - loc_school_elementary_district_geoid
        - loc_school_secondary_district_geoid
        - loc_access_cmap_walk_nta_score
        - loc_access_cmap_walk_total_score
        - loc_tax_municipality_name
        - prox_num_pin_in_half_mile
        - prox_num_bus_stop_in_half_mile
        - prox_num_foreclosure_per_1000_pin_past_5_years
        - prox_num_school_in_half_mile
        - prox_num_school_with_rating_in_half_mile
        - prox_avg_school_rating_in_half_mile
        - prox_nearest_bike_trail_dist_ft
        - prox_nearest_cemetery_dist_ft
        - prox_nearest_cta_route_dist_ft
        - prox_nearest_cta_stop_dist_ft
        - prox_nearest_hospital_dist_ft
        - prox_lake_michigan_dist_ft
        - prox_nearest_major_road_dist_ft
        - prox_nearest_metra_route_dist_ft
        - prox_nearest_metra_stop_dist_ft
        - prox_nearest_park_dist_ft
        - prox_nearest_railroad_dist_ft
        - prox_nearest_water_dist_ft
        - prox_nearest_golf_course_dist_ft
        - acs5_percent_age_children
        - acs5_percent_age_senior
        - acs5_median_age_total
        - acs5_percent_mobility_no_move
        - acs5_percent_mobility_moved_from_other_state
        - acs5_percent_household_family_married
        - acs5_percent_household_nonfamily_alone
        - acs5_percent_education_high_school
        - acs5_percent_education_bachelor
        - acs5_percent_education_graduate
        - acs5_percent_income_below_poverty_level
        - acs5_median_income_household_past_year
        - acs5_median_income_per_capita_past_year
        - acs5_percent_income_household_received_snap_past_year
        - acs5_percent_employment_unemployed
        - acs5_median_household_total_occupied_year_built
        - acs5_median_household_renter_occupied_gross_rent
        - acs5_percent_household_owner_occupied
        - acs5_percent_household_total_occupied_w_sel_cond
        - acs5_percent_mobility_moved_in_county
        - other_tax_bill_rate
        - other_school_district_elementary_avg_rating
        - other_school_district_secondary_avg_rating
        - time_sale_year
        - time_sale_day
        - time_sale_quarter_of_year
        - time_sale_month_of_year
        - time_sale_day_of_year
        - time_sale_day_of_month
        - time_sale_day_of_week
        - time_sale_post_covid
    outs:
    - path: output/feature_importance/model_feature_importance.parquet
      hash: md5
      md5: 05cfd51dc2c5e9a52a8647c3fb9ccc3b
      size: 9405
    - path: output/intermediate/timing/model_timing_interpret.parquet
      hash: md5
      md5: 25cedf31c13aff7948f5ce29e951deea
      size: 2914
    - path: output/shap/model_shap.parquet
      hash: md5
      md5: 3b2015c65992cfcc2a46b1c029d62212
      size: 501
  finalize:
    cmd: Rscript pipeline/05-finalize.R
    deps:
    - path: pipeline/05-finalize.R
      hash: md5
      md5: 5c5a5100ebae2013bc24e8f9333d136b
      size: 8762
    - path: output/intermediate/timing/model_timing_assess.parquet
      hash: md5
      md5: 5f93cb109c073d91a9c9b55b3a56755b
      size: 2879
    - path: output/intermediate/timing/model_timing_evaluate.parquet
      hash: md5
      md5: e16336c33032e94c91d6ee9ea2920017
      size: 2907
    - path: output/intermediate/timing/model_timing_interpret.parquet
      hash: md5
      md5: 25cedf31c13aff7948f5ce29e951deea
      size: 2914
    - path: output/intermediate/timing/model_timing_train.parquet
      hash: md5
      md5: 7f02eeef83ef3f304af6818101023cff
      size: 2872
    params:
      params.yaml:
        cv:
          split_prop: 0.9
          initial_set: 25
          max_iterations: 70
          no_improve: 30
          best_metric: rmse
        input:
          min_sale_year: '2014'
          max_sale_year: '2022'
          time_split: 15
          complex:
            match_exact:
            - meta_township_code
            - meta_class
            - char_bsmt
            - char_gar1_size
            - char_attic_fnsh
            - char_beds
            - meta_pin_num_cards
            - meta_tieback_proration_rate
            match_fuzzy:
              rooms: 1
              bldg_sf: 25
              yrblt: 4
              dist_ft: 250
        model:
          engine: lightgbm
          objective: rmse
          seed: 2023
          deterministic: true
          force_row_wise: true
          verbose: -1
          predictor:
            all:
            - meta_township_code
            - meta_nbhd_code
            - meta_modeling_group
            - meta_tieback_proration_rate
            - char_yrblt
            - char_air
            - char_apts
            - char_attic_fnsh
            - char_attic_type
            - char_beds
            - char_bldg_sf
            - char_bsmt
            - char_bsmt_fin
            - char_ext_wall
            - char_fbath
            - char_frpl
            - char_gar1_area
            - char_gar1_att
            - char_gar1_cnst
            - char_gar1_size
            - char_hbath
            - char_land_sf
            - char_heat
            - char_ncu
            - char_porch
            - char_roof_cnst
            - char_rooms
            - char_tp_dsgn
            - char_tp_plan
            - char_type_resd
            - char_recent_renovation
            - loc_longitude
            - loc_latitude
            - loc_env_flood_fema_sfha
            - loc_env_flood_fs_factor
            - loc_env_flood_fs_risk_direction
            - loc_env_airport_noise_dnl
            - loc_school_elementary_district_geoid
            - loc_school_secondary_district_geoid
            - loc_access_cmap_walk_nta_score
            - loc_access_cmap_walk_total_score
            - loc_tax_municipality_name
            - prox_num_pin_in_half_mile
            - prox_num_bus_stop_in_half_mile
            - prox_num_foreclosure_per_1000_pin_past_5_years
            - prox_num_school_in_half_mile
            - prox_num_school_with_rating_in_half_mile
            - prox_avg_school_rating_in_half_mile
            - prox_nearest_bike_trail_dist_ft
            - prox_nearest_cemetery_dist_ft
            - prox_nearest_cta_route_dist_ft
            - prox_nearest_cta_stop_dist_ft
            - prox_nearest_hospital_dist_ft
            - prox_lake_michigan_dist_ft
            - prox_nearest_major_road_dist_ft
            - prox_nearest_metra_route_dist_ft
            - prox_nearest_metra_stop_dist_ft
            - prox_nearest_park_dist_ft
            - prox_nearest_railroad_dist_ft
            - prox_nearest_water_dist_ft
            - prox_nearest_golf_course_dist_ft
            - acs5_percent_age_children
            - acs5_percent_age_senior
            - acs5_median_age_total
            - acs5_percent_mobility_no_move
            - acs5_percent_mobility_moved_from_other_state
            - acs5_percent_household_family_married
            - acs5_percent_household_nonfamily_alone
            - acs5_percent_education_high_school
            - acs5_percent_education_bachelor
            - acs5_percent_education_graduate
            - acs5_percent_income_below_poverty_level
            - acs5_median_income_household_past_year
            - acs5_median_income_per_capita_past_year
            - acs5_percent_income_household_received_snap_past_year
            - acs5_percent_employment_unemployed
            - acs5_median_household_total_occupied_year_built
            - acs5_median_household_renter_occupied_gross_rent
            - acs5_percent_household_owner_occupied
            - acs5_percent_household_total_occupied_w_sel_cond
            - acs5_percent_mobility_moved_in_county
            - other_tax_bill_rate
            - other_school_district_elementary_avg_rating
            - other_school_district_secondary_avg_rating
            - time_sale_year
            - time_sale_day
            - time_sale_quarter_of_year
            - time_sale_month_of_year
            - time_sale_day_of_year
            - time_sale_day_of_month
            - time_sale_day_of_week
            - time_sale_post_covid
            categorical:
            - meta_township_code
            - meta_nbhd_code
            - meta_modeling_group
            - char_air
            - char_apts
            - char_attic_fnsh
            - char_attic_type
            - char_bsmt
            - char_bsmt_fin
            - char_ext_wall
            - char_gar1_area
            - char_gar1_att
            - char_gar1_cnst
            - char_gar1_size
            - char_heat
            - char_porch
            - char_roof_cnst
            - char_tp_dsgn
            - char_tp_plan
            - char_type_resd
            - loc_tax_municipality_name
            - loc_school_elementary_district_geoid
            - loc_school_secondary_district_geoid
            - time_sale_quarter_of_year
            id:
            - meta_year
            - meta_pin
            - meta_class
            - meta_card_num
            - meta_sale_document_num
          parameter:
            num_iterations: 200
            learning_rate: 0.1
            validation_prop: 0.1
            validation_type: recent
            validation_metric: rmse
            link_max_depth: true
            max_bin: 128
            stop_iter: 40
          hyperparameter:
            default:
              num_leaves: 200
              add_to_linked_depth: 4
              feature_fraction: 0.475
              min_gain_to_split: 5.5
              min_data_in_leaf: 4
              max_cat_threshold: 200
              min_data_per_group: 75
              cat_smooth: 40.0
              cat_l2: 1.0
              lambda_l1: 0.124
              lambda_l2: 1.655
            range:
              num_leaves:
              - 50
              - 2000
              add_to_linked_depth:
              - 1
              - 7
              feature_fraction:
              - 0.3
              - 0.7
              min_gain_to_split:
              - -3.0
              - 4
              min_data_in_leaf:
              - 2
              - 300
              max_cat_threshold:
              - 10
              - 250
              min_data_per_group:
              - 4
              - 300
              cat_smooth:
              - 10.0
              - 200.0
              cat_l2:
              - -3
              - 2
              lambda_l1:
              - -3
              - 2
              lambda_l2:
              - -3
              - 2
        pv:
          multicard_yoy_cap: 2.2
          land_pct_of_total_cap: 0.5
          round_break:
          - 1000
          - 10000
          - 100000
          round_to_nearest:
          - 1
          - 500
          - 5000
          - 10000
          round_type: floor
        ratio_study:
          far_year: '2020'
          far_stage: board
          far_column: meta_2yr_pri_board_tot
          near_year: '2022'
          near_stage: certified
          near_column: meta_certified_tot
          min_n_sales: 30
          num_quantile:
          - 3
          - 5
          - 10
          geographies:
          - meta_township_code
          - meta_nbhd_code
          - loc_tax_municipality_name
          - loc_ward_num
          - loc_census_puma_geoid
          - loc_census_tract_geoid
          - loc_school_elementary_district_geoid
          - loc_school_secondary_district_geoid
          - loc_school_unified_district_geoid
        run_note: "Test run for updated 2024 model pipeline. Uses 2022 data to assess\
          \ 2023\nsince full 2023 data isn't available yet\n"
        toggle:
          cv_enable: false
          shap_enable: false
          upload_enable: false
    outs:
    - path: output/intermediate/timing/model_timing_finalize.parquet
      hash: md5
      md5: e0859980cd03fbaeebebb42b79c08fe4
      size: 2907
    - path: output/metadata/model_metadata.parquet
      hash: md5
      md5: 1244788bb221ca3c7401d1d37dae462f
      size: 26309
    - path: output/timing/model_timing.parquet
      hash: md5
      md5: 86b808027cf9d137e62e1e071a1b7148
      size: 6039
    - path: reports/performance.html
      hash: md5
      md5: 5eb17984de0a29d0ae2fdee0f6bfd53a
      size: 73
  export:
    cmd: Rscript pipeline/07-export.R
    deps:
    - path: pipeline/07-export.R
      hash: md5
      md5: b4615315b52165eed4a030c94def015b
      size: 33718
    params:
      params.yaml:
        assessment.year: '2023'
        export:
          triad_code: '3'
          run_id: 2023-03-14-clever-damani
        input.max_sale_year: '2022'
        input.min_sale_year: '2014'
        ratio_study:
          far_year: '2020'
          far_stage: board
          far_column: meta_2yr_pri_board_tot
          near_year: '2022'
          near_stage: certified
          near_column: meta_certified_tot
          min_n_sales: 30
          num_quantile:
          - 3
          - 5
          - 10
          geographies:
          - meta_township_code
          - meta_nbhd_code
          - loc_tax_municipality_name
          - loc_ward_num
          - loc_census_puma_geoid
          - loc_census_tract_geoid
          - loc_school_elementary_district_geoid
          - loc_school_secondary_district_geoid
          - loc_school_unified_district_geoid
  upload:
    cmd: Rscript pipeline/06-upload.R
    deps:
    - path: pipeline/06-upload.R
      hash: md5
      md5: 3b7d11c518447cf6c14ec7668c488968
      size: 11733
    - path: output/assessment_card/model_assessment_card.parquet
      hash: md5
      md5: 7f558cd27ce54a39390180383a0af3fc
      size: 34843216
    - path: output/assessment_pin/model_assessment_pin.parquet
      hash: md5
      md5: f5641cb4506847814181996692064b6e
      size: 89391907
    - path: output/feature_importance/model_feature_importance.parquet
      hash: md5
      md5: 05cfd51dc2c5e9a52a8647c3fb9ccc3b
      size: 9405
    - path: output/metadata/model_metadata.parquet
      hash: md5
      md5: 1244788bb221ca3c7401d1d37dae462f
      size: 26309
    - path: output/parameter_final/model_parameter_final.parquet
      hash: md5
      md5: 5cfb3213a46b91fb9afba746d7c09db8
      size: 8508
    - path: output/parameter_range/model_parameter_range.parquet
      hash: md5
      md5: 3b2015c65992cfcc2a46b1c029d62212
      size: 501
    - path: output/parameter_search/model_parameter_search.parquet
      hash: md5
      md5: 3b2015c65992cfcc2a46b1c029d62212
      size: 501
    - path: output/performance/model_performance_assessment.parquet
      hash: md5
      md5: 124e17d2c3beb4dacd2a9397cd37b39a
      size: 1250405
    - path: output/performance/model_performance_test.parquet
      hash: md5
      md5: aed3bdb494181033531cd65e0e38f254
      size: 8627526
    - path: output/performance_quantile/model_performance_quantile_assessment.parquet
      hash: md5
      md5: 86ff5a27131e9305ac0637997c11a17a
      size: 2957
    - path: output/performance_quantile/model_performance_quantile_test.parquet
      hash: md5
      md5: 4b3077c37b8add72f823864c596e7f35
      size: 4803385
    - path: output/shap/model_shap.parquet
      hash: md5
      md5: 3b2015c65992cfcc2a46b1c029d62212
      size: 501
    - path: output/test_card/model_test_card.parquet
      hash: md5
      md5: 7387bf631a89e7019f464a82bad4ca57
      size: 1837208
    - path: output/timing/model_timing.parquet
      hash: md5
      md5: 86b808027cf9d137e62e1e071a1b7148
      size: 6039
    - path: output/workflow/fit/model_workflow_fit.zip
      hash: md5
      md5: 2b5b209f96c29217a62907a656793c84
      size: 1591741
    - path: output/workflow/recipe/model_workflow_recipe.rds
      hash: md5
      md5: 6365fd821ed4322bd2181e6996cbbe6e
      size: 1863122
    - path: reports/performance.html
      hash: md5
      md5: 5eb17984de0a29d0ae2fdee0f6bfd53a
      size: 73
